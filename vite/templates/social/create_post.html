{% extends 'social/base.html' %}
{% load static %}
{% block content %}
<!-- نموذج إنشاء منشور -->
<div class="card mb-4">
    <div class="card-body">
        <form method="POST" action="{% url 'create_post' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <h5>انشاء منشور</h5>
            <div class="form-group mb-3">
                <textarea class="form-control bg-light text-dark" name="content" rows="3" placeholder="بماذا تفكر؟"></textarea>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <label for="image-upload" class="btn btn-sm btn-outline-primary me-2">
                        <i class="fas fa-image"></i> صورة
                    </label>
                    <input id="image-upload" type="file" name="image" accept="image/*" style="display: none;" onchange="previewFile(this, 'image')">
                    
                    <label for="video-upload" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-video"></i> فيديو
                    </label>
                    <input id="video-upload" type="file" name="video" accept="video/*" style="display: none;" onchange="previewFile(this, 'video')">
                </div>
                <button type="submit" class="btn btn-primary">نشر</button>
            </div>

            <!-- معاينة المرفقات -->
            <div id="media-preview" class="mt-3"></div>
        </form>
    </div>
</div>

<script>
function previewFile(input, type) {
    const previewContainer = document.getElementById('media-preview');
    previewContainer.innerHTML = ''; // مسح المحتوى السابق

    if (input.files && input.files[0]) {
        const file = input.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
            if (type === 'image') {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'img-fluid rounded';
                img.style.maxHeight = '300px';
                previewContainer.appendChild(img);
            } else if (type === 'video') {
                const video = document.createElement('video');
                video.src = e.target.result;
                video.controls = true;
                video.className = 'img-fluid rounded';
                video.style.maxHeight = '300px';
                previewContainer.appendChild(video);
            }
        }

        reader.readAsDataURL(file);
    }
}
</script>

<style>
#media-preview {
    border: 1px dashed #ccc;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    min-height: 50px;
}
</style>
{% endblock %}